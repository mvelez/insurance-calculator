<!doctype html>

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="my-questions">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
    </style>
    <style include="iron-flex iron-flex-alignment"></style>
    <style>
        .container {
          @apply(--layout-horizontal);
          @apply(--layout-justified);
        }
    </style>

    <div class="card">
      <h1>Questions</h1>
      <p>
        The questions below will help to determine different options that you
        have for providing coverage for yourself and your family and if there
        are any things which will affect your premium.  For your privacy, none
        of this information is being saved.
      </p>


      <paper-dropdown-menu label="Annual salary range" >
        <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{selectedIncomeBracket}}">
          <template is="dom-repeat" items="{{incomeBrackets.incomeBrackets}}" as="item">
              <paper-item value="{{item.incomeBracket}}">{{item.incomeBracket}}</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      <paper-toggle-button value="{{useTobacco}}" on-click="_toggleTobacco">Are you a tobacco user?</paper-toggle-button>
      <div>
        <paper-dropdown-menu label="Children being covered">
          <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{selectedChildren}}">
            <paper-item value="0">Zero</paper-item>
            <paper-item value="1">One</paper-item>
            <paper-item value="2">Two or more</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>
      <paper-dropdown-menu label="Do you live in a surcharge state?">
        <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{surchargeState}}">
          <template is="dom-repeat" items="{{addons.stateSurcharge}}" as="item">
              <paper-item value="{{item.state}}">{{item.state}}</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      <div>
        <paper-dropdown-menu label="Adults being covered">
          <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{selectedAdults}}">
            <paper-item value="1">One (Employee)</paper-item>
            <paper-item value="2">Two</paper-item>
            <paper-item value="3">Three or more</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>

      <div hidden$="{{hideSpousalOptions}}">
        <paper-card heading="Does their employer offer coverage?">
          <div class="card-content">
            <paper-toggle-button on-click="_showSpousalCoverageCosts">Yes</paper-toggle-button>
            <paper-input label="Annual co-pay a single person?" type="number" hidden$="{{hideSpousalCoverageCosts}}">
              <div prefix>$</div>
            </paper-input>
            <paper-input label="Annual co-pay for a plan that covers everyone?" type="number" hidden$="{{hideSpousalCoverageCosts}}">
              <div prefix>$</div>
            </paper-input>
          </div>
        </paper-card>
      </div>

      <div class="container">
        <a href="/overview"><paper-button raised>Back</paper-button></a>
        <a href="/options"><paper-button raised>Next</paper-button></a>
      </div>
    </div>

    <iron-ajax
      auto
      url="/data/income-brackets.json"
      method="get"
      handle-as="json"
      last-response="{{incomeBrackets}}" />
    <iron-ajax
      auto
      url="/data/addons-2017.json"
      method="get"
      handle-as="json"
      last-response="{{addons}}" />
  </template>

  <script>
    Polymer({
      is: 'my-questions',
      properties: {
        incomeBrackets: Object,
        addons: Object,
        hideSpousalCoverageCosts: {
          type: Boolean,
          value: true, // init the value to true so it will be hidden on page load
        },
        hideSpousalOptions: {
          type: Boolean,
          value: true,
        },
        selectedIncomeBracket: {
          type: String,
          notify: true,
        },
        selectedChildren: {
          type: String,
          value: '0', // default to 0
          notify: true,
        },
        selectedAdults: {
          type: String,
          notify: true,
          value: '1', // default to 1
          observer: '_selectedAdultsChanged',
        },
        useTobacco: {
          type: Boolean,
          value: false, // default to No
          notify: true,
        },
        surchargeState: {
          type: String,
          value: 'No.', // default to No
          notify: true,
        },
        filterOptions: {
          type: Object,
          notify: true,
          computed: 'buildFilterOptions(selectedIncomeBracket, selectedChildren, selectedAdults, useTobacco, surchargeState)',
        },
      },
      _showSpousalCoverageCosts() {
        // this.hideSpousalCoverageCosts = !this.hideSpousalCoverageCosts;
      },
      _toggleTobacco() {
        this.useTobacco = !this.useTobacco;
      },
      _selectedAdultsChanged(newIndex) {
        // this.set('hideSpousalOptions', newIndex === '1');
      },
      buildFilterOptions(selectedIncomeBracket, selectedChildren,
        selectedAdults, useTobacco, surchargeState) {
        var filterOptions = {};
        filterOptions.incomeBracket = selectedIncomeBracket;
        filterOptions.useTobacco = useTobacco;
        filterOptions.surchargeState = surchargeState;
        filterOptions.coverageLevels = [];

        // simple options based on number of people
        if (selectedAdults === '1' && selectedChildren === '0') {
          // Single person only needs single coverage.
          filterOptions.coverageLevels.push('1');
        } else if (selectedAdults === '1' && selectedChildren === '1') {
          // Single parent needs coverage for themself and their child.
          filterOptions.coverageLevels.push('2');
        } else if (selectedAdults === '1' && selectedChildren === '2') {
          // Single parent needs coverage for themself and their children.
          filterOptions.coverageLevels.push('3+');
        } else if (selectedAdults === '2' && selectedChildren === '0') {
          // TODO: Split this condition on whether or not spouse has coverage.
          // Childless couple, spouse may have coverage from their employer
          filterOptions.coverageLevels.push('1');
          filterOptions.coverageLevels.push('2');
        // } else if (selectedAdults === '3' && selectedChildren === '0') {
        //   // TODO: Split this condition on whether or not spouse has coverage.
        //   // Multiple adults may have coverage from their employers
        //   filterOptions.coverageLevels.push('1');
        //   filterOptions.coverageLevels.push('2');
        //   filterOptions.coverageLevels.push('3+');
        // } else if (selectedAdults !== '1' && selectedChildren !== '0') {
        //   // TODO: Split this condition on whether or not spouse has coverage.
        //   // Multiple adults with children. Adults may have other options.
        //   filterOptions.coverageLevels.push('1');
        //   filterOptions.coverageLevels.push('2');
        //   filterOptions.coverageLevels.push('3+');
        // }
        } else {
          // These are more complicated situations where the user needs to see all options.
          filterOptions.coverageLevels.push('1');
          filterOptions.coverageLevels.push('2');
          filterOptions.coverageLevels.push('3+');
        }

        return filterOptions;
      },
    });

  </script>
</dom-module>
